

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>2.3 Data Exploration Report &#8212; MRes Project</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '2.3_Data_Exploration_Report';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="2.4 Data Quality Report" href="2.4_Data_Quality_Report.html" />
    <link rel="prev" title="2.2 Data Description Report" href="2.2_Data_Description_Report.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>


  <div class="bd-header-announcement container-fluid bd-header-announcement">
    <div class="bd-header-announcement__content">MRes Project Exploratory Data Analysis</div>
  </div>

  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="1_Understanding_Context.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="1_Understanding_Context.html">
                    1 Understanding Context
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="2.1_Initial_Data_Collection_Report.html">2.1 Data Collection Report</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.2_Data_Description_Report.html">2.2 Data Description Report</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">2.3 Data Exploration Report</a></li>

<li class="toctree-l1"><a class="reference internal" href="2.4_Data_Quality_Report.html">2.4 Data Quality Report</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_Data_Preparation.html">3 Data Preparation</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_Modelling.html">4 Modelling Report</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_Modelling_2.html">4 Modelling</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/carrowmw/mres-project" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/carrowmw/mres-project/issues/new?title=Issue%20on%20page%20%2F2.3_Data_Exploration_Report.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/2.3_Data_Exploration_Report.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>2.3 Data Exploration Report</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">2.3 Data Exploration Report</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#file-access-and-save-paths">2.3.1 File access and save paths</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview-of-flow-patterns">2.3.2 Overview of Flow Patterns</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#average-flow-per-hour-by-month">2.3.2.1 Average flow per hour by month</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#flow-per-hour-by-month-and-quarter-with-mean-trendline">2.3.2.2 Flow per hour by month and quarter with mean trendline</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#weekday-vs-weekend-flow-per-hour-by-quarter-with-mean-trendline">2.3.2.3 Weekday vs Weekend flow per hour by quarter with mean trendline</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#properties-of-flow-patterns">2.3.3 Properties of flow patterns</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pattern-properties-of-quarterly-mean-trendlines">2.3.3.1 Pattern properties of quarterly mean trendlines</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pattern-properties-of-monthly-mean-trendlines">2.3.3.2 Pattern properties of monthly mean trendlines</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#signal-decomposition">2.3.4 Signal decomposition</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="data-exploration-report">
<h1>2.3 Data Exploration Report<a class="headerlink" href="#data-exploration-report" title="Permalink to this heading">#</a></h1>
<p>In this section, we will explore the data and present our findings:</p>
<ul class="simple">
<li><p>Statistics: basic descriptive statistics for each feature (mean, median, range, standard deviation, etc.).</p></li>
<li><p>Visualizations: charts or graphs that help understand the data better. These might include histograms, scatter plots, box plots, etc.</p></li>
<li><p>Initial findings: any interesting insights gained from the data, potential relationships between features, or patterns in the data.</p></li>
<li><p>Potential hypotheses: based on our initial exploration, propose hypotheses about the data that could be tested or investigated further in the data mining process.</p></li>
</ul>
<section id="file-access-and-save-paths">
<span id="id2"></span><h2>2.3.1 File access and save paths<a class="headerlink" href="#file-access-and-save-paths" title="Permalink to this heading">#</a></h2>
<p>Here we will import the helper functions and setup up the save paths for the data and figures that are generated.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create the file paths for reading in data and for outputting figures and tables</span>
<span class="n">DATA_PATH</span> <span class="o">=</span> <span class="s2">&quot;../data/saville_row_east_west/&quot;</span>
<span class="n">OUTPUT_TABLES_PATH</span> <span class="o">=</span> <span class="s2">&quot;../output/tables/2.3/&quot;</span>
<span class="n">OUTPUT_FIGURES_PATH</span> <span class="o">=</span> <span class="s2">&quot;../output/figures/2.3/&quot;</span>

<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">DATA_PATH</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">OUTPUT_TABLES_PATH</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">OUTPUT_FIGURES_PATH</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># get custom color palette and colormap</span>
<span class="kn">from</span> <span class="nn">eda_helper</span> <span class="kn">import</span> <span class="n">get_custom_palette</span><span class="p">,</span> <span class="n">get_custom_colormap</span>

<span class="n">custom_palette</span> <span class="o">=</span> <span class="n">get_custom_palette</span><span class="p">()</span>
<span class="n">custom_colormap</span> <span class="o">=</span> <span class="n">get_custom_colormap</span><span class="p">()</span>

<span class="c1"># read in the files for exploration</span>
<span class="n">east_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_PATH</span><span class="p">,</span> <span class="s2">&quot;east_df.pkl&quot;</span><span class="p">))</span>
<span class="n">west_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_PATH</span><span class="p">,</span> <span class="s2">&quot;west_df.pkl&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>If we look at some of the descriptive statistics we can see that the data sets are both fairly similar. We will focus on the <code class="docutils literal notranslate"><span class="pre">value</span></code> attribute which show the number of people detected in the last 15-minutes. From the stats we can see that the east facing sensor is slightly more skewed towards zero than the west facing sensor.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">east_ped_counts_descriptive</span> <span class="o">=</span> <span class="n">east_df</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">west_ped_counts_descriptive</span> <span class="o">=</span> <span class="n">west_df</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;East - Value&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">east_ped_counts_descriptive</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;West - Value&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">west_ped_counts_descriptive</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>East - Value
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>79522.0</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>76.9</td>
    </tr>
    <tr>
      <th>std</th>
      <td>102.3</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.0</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>7.0</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>30.0</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>112.0</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1898.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>West - Value
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>79787.0</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>99.9</td>
    </tr>
    <tr>
      <th>std</th>
      <td>136.3</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.0</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>7.0</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>40.0</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>141.0</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2432.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">east_ped_counts_descriptive</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">OUTPUT_TABLES_PATH</span><span class="p">,</span>
        <span class="s2">&quot;East sensor descriptive statistics for pedestrian count.csv&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">west_ped_counts_descriptive</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">OUTPUT_TABLES_PATH</span><span class="p">,</span>
        <span class="s2">&quot;West sensor descriptive statistics for pedestrian count.csv&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># sorts east_df by hour and minute of the day</span>
<span class="n">east_df</span> <span class="o">=</span> <span class="n">east_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>

<span class="c1"># groups on year-month-day-hour and yields sum (total pedestrians per hour)</span>
<span class="n">east_hour_of_the_day_sum_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">east_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;year-month-day-hour&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hours_since_midnight&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
            <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
            <span class="s2">&quot;year-month&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
            <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
            <span class="s2">&quot;month-hour&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;hours_since_midnight&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># groups and sums on month-hour and yield mean (average pedestrians per hour in each month)</span>
<span class="n">east_hour_month_average_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">east_hour_of_the_day_sum_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;month-hour&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;hours_since_midnight&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span> <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">})</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;hours_since_midnight&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># sorts west_df by hour and minute of the day</span>
<span class="n">west_df</span> <span class="o">=</span> <span class="n">west_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>

<span class="c1"># groups on year-month-day-hour and yields sum (total pedestrians per hour)</span>
<span class="n">west_hour_of_the_day_sum_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">west_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;year-month-day-hour&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hours_since_midnight&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
            <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
            <span class="s2">&quot;year-month&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
            <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
            <span class="s2">&quot;month-hour&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;hours_since_midnight&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># groups and sums on month-hour and yield mean (average pedestrians per hour in each month)</span>
<span class="n">west_hour_month_average_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">west_hour_of_the_day_sum_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;month-hour&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;hours_since_midnight&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span> <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="s2">&quot;first&quot;</span><span class="p">})</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;hours_since_midnight&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="overview-of-flow-patterns">
<span id="id3"></span><h2>2.3.2 Overview of Flow Patterns<a class="headerlink" href="#overview-of-flow-patterns" title="Permalink to this heading">#</a></h2>
<section id="average-flow-per-hour-by-month">
<span id="id4"></span><h3>2.3.2.1 Average flow per hour by month<a class="headerlink" href="#average-flow-per-hour-by-month" title="Permalink to this heading">#</a></h3>
<p>The following graph shows the variation in average flow for each month at each hour of the day.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib</span>

<span class="n">east_len_months</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">east_hour_month_average_df</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]))</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span>
    <span class="p">[</span><span class="n">custom_colormap</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="p">(</span><span class="n">east_len_months</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">east_len_months</span><span class="p">)]</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;hspace&quot;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">})</span>

<span class="c1"># loop through each unique month value for east</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">east_hour_month_average_df</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">])):</span>
    <span class="c1"># filter the DataFrame for the current month</span>
    <span class="n">month_df</span> <span class="o">=</span> <span class="n">east_hour_month_average_df</span><span class="p">[</span><span class="n">east_hour_month_average_df</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">month</span><span class="p">]</span>

    <span class="c1"># plot the line for the current month with the corresponding color from the colormap</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">month_df</span><span class="p">[</span><span class="s2">&quot;hours_since_midnight&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
        <span class="n">month_df</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Month </span><span class="si">{</span><span class="n">month</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time of day (hour)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Pedestrian flow (hourly sum)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;East&quot;</span><span class="p">)</span>

<span class="c1"># loop through each unique month value for west</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">west_hour_month_average_df</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">])):</span>
    <span class="c1"># filter the DataFrame for the current month</span>
    <span class="n">month_df</span> <span class="o">=</span> <span class="n">west_hour_month_average_df</span><span class="p">[</span><span class="n">west_hour_month_average_df</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">month</span><span class="p">]</span>

    <span class="c1"># plot the line for the current month with the corresponding color from the colormap</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">month_df</span><span class="p">[</span><span class="s2">&quot;hours_since_midnight&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
        <span class="n">month_df</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Month </span><span class="si">{</span><span class="n">month</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time of day (hour)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Pedestrian flow (hourly sum)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;West&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>  <span class="c1"># create some space on the right side for the colorbar</span>

<span class="n">cbar_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span>
    <span class="p">[</span><span class="mf">0.88</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">]</span>
<span class="p">)</span>  <span class="c1"># position of colorbar [left, bottom, width, height]</span>

<span class="c1"># add a colorbar to show the mapping of colors to months</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">east_len_months</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">),</span>
    <span class="n">cax</span><span class="o">=</span><span class="n">cbar_ax</span><span class="p">,</span>
    <span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">east_len_months</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;Jan&quot;</span><span class="p">,</span> <span class="s2">&quot;Feb&quot;</span><span class="p">,</span> <span class="s2">&quot;Mar&quot;</span><span class="p">,</span> <span class="s2">&quot;Apr&quot;</span><span class="p">,</span> <span class="s2">&quot;May&quot;</span><span class="p">,</span> <span class="s2">&quot;Jun&quot;</span><span class="p">,</span> <span class="s2">&quot;Jul&quot;</span><span class="p">,</span> <span class="s2">&quot;Aug&quot;</span><span class="p">,</span> <span class="s2">&quot;Sep&quot;</span><span class="p">,</span> <span class="s2">&quot;Oct&quot;</span><span class="p">,</span> <span class="s2">&quot;Nov&quot;</span><span class="p">,</span> <span class="s2">&quot;Dec&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Month&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_FIGURES_PATH</span><span class="p">,</span> <span class="s2">&quot;Average flow per hour by month.svg&quot;</span><span class="p">),</span>
    <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/c90e344f65c7bc90ea6137fe57d64225a4c58b8d9504f154cbdfd4a072ae0d38.png" src="_images/c90e344f65c7bc90ea6137fe57d64225a4c58b8d9504f154cbdfd4a072ae0d38.png" />
</div>
</div>
</section>
<section id="flow-per-hour-by-month-and-quarter-with-mean-trendline">
<span id="id5"></span><h3>2.3.2.2 Flow per hour by month and quarter with mean trendline<a class="headerlink" href="#flow-per-hour-by-month-and-quarter-with-mean-trendline" title="Permalink to this heading">#</a></h3>
<p>The following graph shows the variation in flow throughout the day and across each month and each quarter over a 15 minute period this time. A couple of things are of note here. The first is that there appears to be a a significant difference in the average flow for different months with December and November experiencing far greater flow than in May and June. The y-axis has been limited to 1000, but outliers exist up to 1750 pedestrians per 15 minute period (see section 2.4).It is also worth noting that by grouping into quarters the general pattern shown in the monthly grouping is retained.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">############### Months</span>

<span class="c1"># instantiate the color map and reverse it so it matches the legend order</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="n">custom_colormap</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="mi">11</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">)])</span>

<span class="c1"># For East</span>
<span class="n">east_monthly_interval_mean_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">east_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="s2">&quot;hour-minutes&quot;</span><span class="p">])[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># For West</span>
<span class="n">west_monthly_interval_mean_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">west_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="s2">&quot;hour-minutes&quot;</span><span class="p">])[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">month_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Jan&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Feb&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Mar&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Apr&quot;</span><span class="p">,</span>
    <span class="s2">&quot;May&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Jun&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Jul&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Aug&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Sep&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Oct&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Nov&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Dec&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">):</span>
    <span class="c1"># For East</span>
    <span class="n">month_data</span> <span class="o">=</span> <span class="n">east_monthly_interval_mean_df</span><span class="p">[</span>
        <span class="n">east_monthly_interval_mean_df</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">month</span>
    <span class="p">]</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;hour-minutes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
        <span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">month_names</span><span class="p">[</span><span class="n">month</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">month</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="c1"># For West</span>
    <span class="n">month_data</span> <span class="o">=</span> <span class="n">west_monthly_interval_mean_df</span><span class="p">[</span>
        <span class="n">west_monthly_interval_mean_df</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">month</span>
    <span class="p">]</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;hour-minutes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
        <span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">month_names</span><span class="p">[</span><span class="n">month</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">month</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">sc</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">east_df</span><span class="p">[</span><span class="s2">&quot;hour-minutes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">east_df</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
    <span class="n">c</span><span class="o">=</span><span class="n">east_df</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">west_df</span><span class="p">[</span><span class="s2">&quot;hour-minutes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">west_df</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
    <span class="n">c</span><span class="o">=</span><span class="n">west_df</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time of day&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Pedestrian flow (n/15m)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;East - Months&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time of day&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Pedestrian flow (n/15m)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;West - Months&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="c1">############### Quarters</span>

<span class="c1"># instantiate the color map and reverse it so it matches the legend order</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="n">custom_colormap</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)])</span>

<span class="c1"># For East</span>
<span class="n">east_quarter_interval_mean_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">east_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;quarter&quot;</span><span class="p">,</span> <span class="s2">&quot;hour-minutes&quot;</span><span class="p">])[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="c1"># For West</span>
<span class="n">west_quarter_interval_mean_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">west_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;quarter&quot;</span><span class="p">,</span> <span class="s2">&quot;hour-minutes&quot;</span><span class="p">])[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">sc</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">east_df</span><span class="p">[</span><span class="s2">&quot;hour-minutes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">east_df</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
    <span class="n">c</span><span class="o">=</span><span class="n">east_df</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">west_df</span><span class="p">[</span><span class="s2">&quot;hour-minutes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">west_df</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
    <span class="n">c</span><span class="o">=</span><span class="n">west_df</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">quarter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="c1"># For East</span>
    <span class="n">quarter_data</span> <span class="o">=</span> <span class="n">east_quarter_interval_mean_df</span><span class="p">[</span>
        <span class="n">east_quarter_interval_mean_df</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">quarter</span>
    <span class="p">]</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;hour-minutes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
        <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Q</span><span class="si">{</span><span class="n">quarter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">quarter</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="c1"># For West</span>
    <span class="n">quarter_data</span> <span class="o">=</span> <span class="n">west_quarter_interval_mean_df</span><span class="p">[</span>
        <span class="n">west_quarter_interval_mean_df</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">quarter</span>
    <span class="p">]</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;hour-minutes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
        <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Q</span><span class="si">{</span><span class="n">quarter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">quarter</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time of day&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Pedestrian flow (n/15m)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;East - Quarters&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time of day&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Pedestrian flow (n/15m)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;West - Quarters&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="c1">################ Save both figs</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_FIGURES_PATH</span><span class="p">,</span> <span class="s2">&quot;East_and_West_total_Flow_per_15_Min_Period.svg&quot;</span><span class="p">),</span>
    <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/eafbfd7dbe83819ffb7175b3624ee914bc77ed3452810f99d52408900b5e220a.png" src="_images/eafbfd7dbe83819ffb7175b3624ee914bc77ed3452810f99d52408900b5e220a.png" />
</div>
</div>
</section>
<section id="weekday-vs-weekend-flow-per-hour-by-quarter-with-mean-trendline">
<span id="id6"></span><h3>2.3.2.3 Weekday vs Weekend flow per hour by quarter with mean trendline<a class="headerlink" href="#weekday-vs-weekend-flow-per-hour-by-quarter-with-mean-trendline" title="Permalink to this heading">#</a></h3>
<p>The following graph shows the mean variation in flow throughout the day and across each quarter for weekdays and weekend. From visual inspection it is clear that there is a variation in the shape of the trendline when comparing the same quarter in both graphs for weekday vs weekend.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a mask for weekdays (monday-friday)</span>
<span class="n">weekday_mask</span> <span class="o">=</span> <span class="n">east_df</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">weekday</span> <span class="o">&lt;</span> <span class="mi">5</span>

<span class="c1"># create seperate dataframes for weekdays and weekends</span>
<span class="n">weekday_east_df</span> <span class="o">=</span> <span class="n">east_df</span><span class="p">[</span><span class="n">weekday_mask</span><span class="p">]</span>
<span class="n">weekend_east_df</span> <span class="o">=</span> <span class="n">east_df</span><span class="p">[</span><span class="o">-</span><span class="n">weekday_mask</span><span class="p">]</span>

<span class="c1"># create a mask for weekdays (monday-friday)</span>
<span class="n">weekday_mask</span> <span class="o">=</span> <span class="n">west_df</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">weekday</span> <span class="o">&lt;</span> <span class="mi">5</span>

<span class="c1"># create seperate dataframes for weekdays and weekends</span>
<span class="n">weekday_west_df</span> <span class="o">=</span> <span class="n">west_df</span><span class="p">[</span><span class="n">weekday_mask</span><span class="p">]</span>
<span class="n">weekend_west_df</span> <span class="o">=</span> <span class="n">west_df</span><span class="p">[</span><span class="o">-</span><span class="n">weekday_mask</span><span class="p">]</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># instantiate the color map and reverse it so it matches the legend order</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="n">custom_colormap</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># For East Weekends</span>
<span class="n">east_quarter_interval_mean_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">weekend_east_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;quarter&quot;</span><span class="p">,</span> <span class="s2">&quot;hour-minutes&quot;</span><span class="p">])[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="c1"># For West Weekends</span>
<span class="n">west_quarter_interval_mean_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">weekend_west_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;quarter&quot;</span><span class="p">,</span> <span class="s2">&quot;hour-minutes&quot;</span><span class="p">])[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>


<span class="k">for</span> <span class="n">quarter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="c1"># For East</span>
    <span class="n">quarter_data</span> <span class="o">=</span> <span class="n">east_quarter_interval_mean_df</span><span class="p">[</span>
        <span class="n">east_quarter_interval_mean_df</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">quarter</span>
    <span class="p">]</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;hour-minutes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
        <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Q</span><span class="si">{</span><span class="n">quarter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">quarter</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="c1"># For West</span>
    <span class="n">quarter_data</span> <span class="o">=</span> <span class="n">west_quarter_interval_mean_df</span><span class="p">[</span>
        <span class="n">west_quarter_interval_mean_df</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">quarter</span>
    <span class="p">]</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;hour-minutes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
        <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Q</span><span class="si">{</span><span class="n">quarter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">quarter</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;East Weekends&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time of day&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Pedestrian flow (n/15m)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;West Weekends&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time of day&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Pedestrian flow (n/15m)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># For East Weekdays</span>
<span class="n">east_quarter_interval_mean_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">weekday_east_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;quarter&quot;</span><span class="p">,</span> <span class="s2">&quot;hour-minutes&quot;</span><span class="p">])[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="c1"># For West Weekdays</span>
<span class="n">west_quarter_interval_mean_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">weekday_west_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;quarter&quot;</span><span class="p">,</span> <span class="s2">&quot;hour-minutes&quot;</span><span class="p">])[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">quarter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="c1"># For East</span>
    <span class="n">quarter_data</span> <span class="o">=</span> <span class="n">east_quarter_interval_mean_df</span><span class="p">[</span>
        <span class="n">east_quarter_interval_mean_df</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">quarter</span>
    <span class="p">]</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;hour-minutes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
        <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Q</span><span class="si">{</span><span class="n">quarter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">quarter</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="c1"># For West</span>
    <span class="n">quarter_data</span> <span class="o">=</span> <span class="n">west_quarter_interval_mean_df</span><span class="p">[</span>
        <span class="n">west_quarter_interval_mean_df</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">quarter</span>
    <span class="p">]</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;hour-minutes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
        <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Q</span><span class="si">{</span><span class="n">quarter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">quarter</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;East Weekdays&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time of day&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Pedestrian flow (n/15m)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;West Weekdays&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time of day&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Pedestrian flow (n/15m)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">OUTPUT_FIGURES_PATH</span><span class="p">,</span>
        <span class="s2">&quot;Weekday_and_Weekend_Total_Flow_per_15_Min_Period_by_Quarter.svg&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/629afd76433264d1395a670301efb23fb61a97491579c63dd24d8efa923ad6c4.png" src="_images/629afd76433264d1395a670301efb23fb61a97491579c63dd24d8efa923ad6c4.png" />
</div>
</div>
</section>
</section>
<section id="properties-of-flow-patterns">
<span id="id7"></span><h2>2.3.3 Properties of flow patterns<a class="headerlink" href="#properties-of-flow-patterns" title="Permalink to this heading">#</a></h2>
<section id="pattern-properties-of-quarterly-mean-trendlines">
<span id="id8"></span><h3>2.3.3.1 Pattern properties of quarterly mean trendlines<a class="headerlink" href="#pattern-properties-of-quarterly-mean-trendlines" title="Permalink to this heading">#</a></h3>
<p>To investigate the differences between weekdays and weekends, we will generate some metrics that describe the properties of the mean curves and compare them. The metrics we will use are:</p>
<ul class="simple">
<li><p>Area Under Curve (AUC)</p></li>
<li><p>Peak Time and Peak Value</p></li>
<li><p>Width at Half Maximum (WHM)</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>

<span class="c1"># initialize list to store metrics DataFrames for weekends and weekdays</span>
<span class="n">east_weekend_metrics</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">east_weekday_metrics</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">east_quarter_interval_mean_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">weekend_east_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;quarter&quot;</span><span class="p">,</span> <span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">])[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># compute metrics for each quarter and add to DataFrame for weekends</span>
<span class="k">for</span> <span class="n">quarter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="n">quarter_data</span> <span class="o">=</span> <span class="n">east_quarter_interval_mean_df</span><span class="p">[</span>
        <span class="n">east_quarter_interval_mean_df</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">quarter</span>
    <span class="p">]</span>
    <span class="n">auc</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span>
        <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span> <span class="n">dx</span><span class="o">=</span><span class="mi">15</span>
    <span class="p">)</span>  <span class="c1"># dx time interval is 15 minutes</span>
    <span class="n">peak_time</span> <span class="o">=</span> <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">][</span><span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()]</span>
    <span class="n">peak_value</span> <span class="o">=</span> <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">whm_time_range</span> <span class="o">=</span> <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">][</span>
        <span class="p">(</span><span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">peak_value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">whm</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whm_time_range</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">whm_time_range</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="p">)</span>  <span class="c1"># calculate WHM as (minutes_since_midnight is a numeric value)</span>
    <span class="n">east_weekend_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;quarter&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Q</span><span class="si">{</span><span class="n">quarter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
                <span class="s2">&quot;AUC&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">auc</span><span class="p">],</span>
                <span class="s2">&quot;peak_time&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">peak_time</span><span class="p">],</span>
                <span class="s2">&quot;peak_value&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">peak_value</span><span class="p">],</span>
                <span class="s2">&quot;WHM&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">whm</span><span class="p">],</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># similarly, for weekdays</span>
<span class="n">east_quarter_interval_mean_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">weekday_east_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;quarter&quot;</span><span class="p">,</span> <span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">])[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># compute metrics for each quarter and add to DataFrame for weekdays</span>
<span class="k">for</span> <span class="n">quarter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="n">quarter_data</span> <span class="o">=</span> <span class="n">east_quarter_interval_mean_df</span><span class="p">[</span>
        <span class="n">east_quarter_interval_mean_df</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">quarter</span>
    <span class="p">]</span>
    <span class="n">auc</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span>
        <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span> <span class="n">dx</span><span class="o">=</span><span class="mi">15</span>
    <span class="p">)</span>  <span class="c1"># dx time interval is 15 minutes</span>
    <span class="n">peak_time</span> <span class="o">=</span> <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">][</span><span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()]</span>
    <span class="n">peak_value</span> <span class="o">=</span> <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">whm_time_range</span> <span class="o">=</span> <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">][</span>
        <span class="p">(</span><span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">peak_value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">whm</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whm_time_range</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">whm_time_range</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="p">)</span>  <span class="c1"># calculate WHM as (minutes_since_midnight is a numeric value)</span>
    <span class="n">east_weekday_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;quarter&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Q</span><span class="si">{</span><span class="n">quarter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
                <span class="s2">&quot;AUC&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">auc</span><span class="p">],</span>
                <span class="s2">&quot;peak_time&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">peak_time</span><span class="p">],</span>
                <span class="s2">&quot;peak_value&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">peak_value</span><span class="p">],</span>
                <span class="s2">&quot;WHM&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">whm</span><span class="p">],</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># concatenate the list of dataframes to a single dataframe</span>
<span class="n">east_weekend_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">east_weekend_metrics</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">east_weekday_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">east_weekday_metrics</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;East Weekend Metrics: &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">east_weekend_metrics</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;East Weekday Metrics: &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">east_weekday_metrics</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>East Weekend Metrics: 
  quarter            AUC  peak_time  peak_value  WHM
0      Q1  118374.531122        870  262.474227  360
1      Q2   42141.260671        720   92.023810  390
2      Q3   85991.696861        795  173.730769  450
3      Q4  150118.685195        870  350.230769  345
East Weekday Metrics: 
  quarter            AUC  peak_time  peak_value  WHM
0      Q1  119213.385863        795  234.697211  465
1      Q2   41661.795032        735   85.903846  465
2      Q3   83082.373054        735  150.603175  510
3      Q4  171294.785440        840  353.795455  435
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weekend_west_df</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dt</th>
      <th>value</th>
      <th>veh_class</th>
      <th>dir</th>
      <th>location</th>
      <th>category</th>
      <th>key</th>
      <th>date</th>
      <th>time</th>
      <th>hour-minutes</th>
      <th>...</th>
      <th>month-hour</th>
      <th>year-month</th>
      <th>year-week</th>
      <th>hours_since_midnight</th>
      <th>minutes_since_midnight</th>
      <th>year-quarter</th>
      <th>month</th>
      <th>quarter</th>
      <th>day_in_week</th>
      <th>day_of_week</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>26885</th>
      <td>2022-12-31 00:00:00</td>
      <td>5</td>
      <td>person</td>
      <td>northwest_to_southwest</td>
      <td>NclNorthumberlandStSavilleRowWest</td>
      <td>flow</td>
      <td>2022-12</td>
      <td>2022-12-31</td>
      <td>1900-01-01 00:00:00</td>
      <td>00:00</td>
      <td>...</td>
      <td>12 00</td>
      <td>2022-12</td>
      <td>2022-52</td>
      <td>0</td>
      <td>0</td>
      <td>2022-4</td>
      <td>12</td>
      <td>4</td>
      <td>5</td>
      <td>Saturday</td>
    </tr>
    <tr>
      <th>26889</th>
      <td>2022-12-31 00:00:00</td>
      <td>16</td>
      <td>person</td>
      <td>southwest_to_northwest</td>
      <td>NclNorthumberlandStSavilleRowWest</td>
      <td>flow</td>
      <td>2022-12</td>
      <td>2022-12-31</td>
      <td>1900-01-01 00:00:00</td>
      <td>00:00</td>
      <td>...</td>
      <td>12 00</td>
      <td>2022-12</td>
      <td>2022-52</td>
      <td>0</td>
      <td>0</td>
      <td>2022-4</td>
      <td>12</td>
      <td>4</td>
      <td>5</td>
      <td>Saturday</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2022-05-01 00:00:00</td>
      <td>3</td>
      <td>person</td>
      <td>southwest_to_northwest</td>
      <td>NclNorthumberlandStSavilleRowWest</td>
      <td>flow</td>
      <td>2022-05</td>
      <td>2022-05-01</td>
      <td>1900-01-01 00:00:00</td>
      <td>00:00</td>
      <td>...</td>
      <td>05 00</td>
      <td>2022-05</td>
      <td>2022-18</td>
      <td>0</td>
      <td>0</td>
      <td>2022-2</td>
      <td>5</td>
      <td>2</td>
      <td>6</td>
      <td>Sunday</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2022-05-01 00:00:00</td>
      <td>1</td>
      <td>person</td>
      <td>northwest_to_southwest</td>
      <td>NclNorthumberlandStSavilleRowWest</td>
      <td>flow</td>
      <td>2022-05</td>
      <td>2022-05-01</td>
      <td>1900-01-01 00:00:00</td>
      <td>00:00</td>
      <td>...</td>
      <td>05 00</td>
      <td>2022-05</td>
      <td>2022-18</td>
      <td>0</td>
      <td>0</td>
      <td>2022-2</td>
      <td>5</td>
      <td>2</td>
      <td>6</td>
      <td>Sunday</td>
    </tr>
    <tr>
      <th>8469</th>
      <td>2021-12-25 00:00:00</td>
      <td>4</td>
      <td>person</td>
      <td>southwest_to_northwest</td>
      <td>NclNorthumberlandStSavilleRowWest</td>
      <td>flow</td>
      <td>2021-12</td>
      <td>2021-12-25</td>
      <td>1900-01-01 00:00:00</td>
      <td>00:00</td>
      <td>...</td>
      <td>12 00</td>
      <td>2021-12</td>
      <td>2021-51</td>
      <td>0</td>
      <td>0</td>
      <td>2021-4</td>
      <td>12</td>
      <td>4</td>
      <td>5</td>
      <td>Saturday</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3276</th>
      <td>2022-11-06 23:45:00</td>
      <td>6</td>
      <td>person</td>
      <td>northwest_to_southwest</td>
      <td>NclNorthumberlandStSavilleRowWest</td>
      <td>flow</td>
      <td>2022-11</td>
      <td>2022-11-06</td>
      <td>1900-01-01 23:45:00</td>
      <td>23:45</td>
      <td>...</td>
      <td>11 23</td>
      <td>2022-11</td>
      <td>2022-45</td>
      <td>23</td>
      <td>1425</td>
      <td>2022-4</td>
      <td>11</td>
      <td>4</td>
      <td>6</td>
      <td>Sunday</td>
    </tr>
    <tr>
      <th>3280</th>
      <td>2022-11-06 23:45:00</td>
      <td>15</td>
      <td>person</td>
      <td>southwest_to_northwest</td>
      <td>NclNorthumberlandStSavilleRowWest</td>
      <td>flow</td>
      <td>2022-11</td>
      <td>2022-11-06</td>
      <td>1900-01-01 23:45:00</td>
      <td>23:45</td>
      <td>...</td>
      <td>11 23</td>
      <td>2022-11</td>
      <td>2022-45</td>
      <td>23</td>
      <td>1425</td>
      <td>2022-4</td>
      <td>11</td>
      <td>4</td>
      <td>6</td>
      <td>Sunday</td>
    </tr>
    <tr>
      <th>3825</th>
      <td>2022-01-09 23:45:00</td>
      <td>2</td>
      <td>person</td>
      <td>southwest_to_northwest</td>
      <td>NclNorthumberlandStSavilleRowWest</td>
      <td>flow</td>
      <td>2022-01</td>
      <td>2022-01-09</td>
      <td>1900-01-01 23:45:00</td>
      <td>23:45</td>
      <td>...</td>
      <td>01 23</td>
      <td>2022-01</td>
      <td>2022-02</td>
      <td>23</td>
      <td>1425</td>
      <td>2022-1</td>
      <td>1</td>
      <td>1</td>
      <td>6</td>
      <td>Sunday</td>
    </tr>
    <tr>
      <th>3823</th>
      <td>2022-01-09 23:45:00</td>
      <td>3</td>
      <td>person</td>
      <td>northwest_to_southwest</td>
      <td>NclNorthumberlandStSavilleRowWest</td>
      <td>flow</td>
      <td>2022-01</td>
      <td>2022-01-09</td>
      <td>1900-01-01 23:45:00</td>
      <td>23:45</td>
      <td>...</td>
      <td>01 23</td>
      <td>2022-01</td>
      <td>2022-02</td>
      <td>23</td>
      <td>1425</td>
      <td>2022-1</td>
      <td>1</td>
      <td>1</td>
      <td>6</td>
      <td>Sunday</td>
    </tr>
    <tr>
      <th>19980</th>
      <td>2022-03-20 23:45:00</td>
      <td>5</td>
      <td>person</td>
      <td>southwest_to_northwest</td>
      <td>NclNorthumberlandStSavilleRowWest</td>
      <td>flow</td>
      <td>2022-03</td>
      <td>2022-03-20</td>
      <td>1900-01-01 23:45:00</td>
      <td>23:45</td>
      <td>...</td>
      <td>03 23</td>
      <td>2022-03</td>
      <td>2022-12</td>
      <td>23</td>
      <td>1425</td>
      <td>2022-1</td>
      <td>3</td>
      <td>1</td>
      <td>6</td>
      <td>Sunday</td>
    </tr>
  </tbody>
</table>
<p>23118 rows × 22 columns</p>
</div></div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initialize list to store metrics DataFrames for weekends and weekdays</span>
<span class="n">west_weekend_metrics</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">west_weekday_metrics</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">west_quarter_interval_mean_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">weekend_west_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;quarter&quot;</span><span class="p">,</span> <span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">])[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># compute metrics for each quarter and add to DataFrame for weekends</span>
<span class="k">for</span> <span class="n">quarter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="n">quarter_data</span> <span class="o">=</span> <span class="n">west_quarter_interval_mean_df</span><span class="p">[</span>
        <span class="n">west_quarter_interval_mean_df</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">quarter</span>
    <span class="p">]</span>
    <span class="n">auc</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span>
        <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span> <span class="n">dx</span><span class="o">=</span><span class="mi">15</span>
    <span class="p">)</span>  <span class="c1"># dx time interval is 15 minutes</span>
    <span class="n">peak_time</span> <span class="o">=</span> <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">][</span><span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()]</span>
    <span class="n">peak_value</span> <span class="o">=</span> <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">whm_time_range</span> <span class="o">=</span> <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">][</span>
        <span class="p">(</span><span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">peak_value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">whm</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whm_time_range</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">whm_time_range</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="p">)</span>  <span class="c1"># calculate WHM as (minutes_since_midnight is a numeric value)</span>
    <span class="n">west_weekend_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;quarter&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Q</span><span class="si">{</span><span class="n">quarter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
                <span class="s2">&quot;AUC&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">auc</span><span class="p">],</span>
                <span class="s2">&quot;peak_time&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">peak_time</span><span class="p">],</span>
                <span class="s2">&quot;peak_value&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">peak_value</span><span class="p">],</span>
                <span class="s2">&quot;WHM&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">whm</span><span class="p">],</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># similarly, for weekdays</span>
<span class="n">west_quarter_interval_mean_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">weekday_west_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;quarter&quot;</span><span class="p">,</span> <span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">])[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># compute metrics for each quarter and add to DataFrame for weekdays</span>
<span class="k">for</span> <span class="n">quarter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="n">quarter_data</span> <span class="o">=</span> <span class="n">west_quarter_interval_mean_df</span><span class="p">[</span>
        <span class="n">west_quarter_interval_mean_df</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">quarter</span>
    <span class="p">]</span>
    <span class="n">auc</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span>
        <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span> <span class="n">dx</span><span class="o">=</span><span class="mi">15</span>
    <span class="p">)</span>  <span class="c1"># dx time interval is 15 minutes</span>
    <span class="n">peak_time</span> <span class="o">=</span> <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">][</span><span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()]</span>
    <span class="n">peak_value</span> <span class="o">=</span> <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">whm_time_range</span> <span class="o">=</span> <span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">][</span>
        <span class="p">(</span><span class="n">quarter_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">peak_value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">whm</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whm_time_range</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">whm_time_range</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="p">)</span>  <span class="c1"># calculate WHM as (minutes_since_midnight is a numeric value)</span>
    <span class="n">west_weekday_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;quarter&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Q</span><span class="si">{</span><span class="n">quarter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
                <span class="s2">&quot;AUC&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">auc</span><span class="p">],</span>
                <span class="s2">&quot;peak_time&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">peak_time</span><span class="p">],</span>
                <span class="s2">&quot;peak_value&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">peak_value</span><span class="p">],</span>
                <span class="s2">&quot;WHM&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">whm</span><span class="p">],</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># concatenate the list of dataframes to a single dataframe</span>
<span class="n">west_weekend_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">west_weekend_metrics</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">west_weekday_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">west_weekday_metrics</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;West Weekend Metrics: &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">west_weekend_metrics</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;West Weekday Metrics: &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">west_weekday_metrics</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>West Weekend Metrics: 
  quarter            AUC  peak_time  peak_value  WHM
0      Q1  156468.716432        885  339.402062  390
1      Q2   54892.356767        690  115.282609  405
2      Q3  113224.721871        795  247.700000  405
3      Q4  203720.461499        795  459.692308  390
West Weekday Metrics: 
  quarter            AUC  peak_time  peak_value  WHM
0      Q1  152382.089939        795  301.866397  465
1      Q2   51842.065547        720  103.590000  480
2      Q3  106045.781739        735  190.000000  510
3      Q4  230357.481070        795  456.709677  495
</pre></div>
</div>
</div>
</div>
<p>We can see that peak values remain fairly consistent between weekday/weekend but vary significantly throughout the quarter. The same pattern is very closely mirrored in the AUC curve. The peak time however, does not vary massively throughout the year and there is greater variation between weekends and weekdays. This pattern is reflected more strongly in the WHM plot, where we can see that the weekday/weekend variation is significantly greater than the inter-quarter variation. We can see that these patterns are mirrored and slightly offset for both the sensors directions.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="c1"># define your line scatters for east with color custom_palette[0] for blue</span>
<span class="n">east_weekday_auc</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">],</span>
    <span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;AUC&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;East Weekdays&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">east_weekend_auc</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">],</span>
    <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;AUC&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;East Weekend&quot;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">east_weekday_peak_time</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">],</span>
    <span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;East Weekdays&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">east_weekend_peak_time</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">],</span>
    <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;East Weekend&quot;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">east_weekday_peak_value</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">],</span>
    <span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;East Weekdays&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">east_weekend_peak_value</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">],</span>
    <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;East Weekend&quot;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">east_weekday_whm</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">],</span>
    <span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;WHM&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;East Weekdays&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">east_weekend_whm</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">],</span>
    <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;WHM&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;East Weekend&quot;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>

<span class="c1"># define your line scatters for west with color custom_palette[1] for red</span>
<span class="n">west_weekday_auc</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">],</span>
    <span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;AUC&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;West Weekdays&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">west_weekend_auc</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">],</span>
    <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;AUC&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;West Weekend&quot;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">west_weekday_peak_time</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">],</span>
    <span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;West Weekdays&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">west_weekend_peak_time</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">],</span>
    <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;West Weekend&quot;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">west_weekday_peak_value</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">],</span>
    <span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;West Weekdays&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">west_weekend_peak_value</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">],</span>
    <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;West Weekend&quot;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">west_weekday_whm</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">],</span>
    <span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;WHM&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;West Weekdays&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">west_weekend_whm</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;quarter&quot;</span><span class="p">],</span>
    <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;WHM&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;West Weekend&quot;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="p">)</span>

<span class="c1"># the rest of the code remains unchanged</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Area Under Curve (AUC)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Peak Time&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Peak Value&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Width at Half Maximum (WHM)&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Quarter&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Metric Value&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># add a legend</span>
<span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="p">[</span><span class="n">east_weekday_auc</span><span class="p">,</span> <span class="n">east_weekend_auc</span><span class="p">,</span> <span class="n">west_weekday_auc</span><span class="p">,</span> <span class="n">west_weekend_auc</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;East Weekdays&quot;</span><span class="p">,</span> <span class="s2">&quot;East Weekend&quot;</span><span class="p">,</span> <span class="s2">&quot;West Weekdays&quot;</span><span class="p">,</span> <span class="s2">&quot;West Weekend&quot;</span><span class="p">],</span>
    <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/840e454b8dcdf062162bbbd5c5f86b4510766fefb791dcdd450e37446c33e88f.png" src="_images/840e454b8dcdf062162bbbd5c5f86b4510766fefb791dcdd450e37446c33e88f.png" />
</div>
</div>
<p>Rather looking at the Peak time and Peak time in isolation we should plot them with time of day on the x-axis and flow on the y-axis as above. This plot shows more clearly how peak values change relative to peak time throughout the year and for weekend/weekday. It is evident that the peak time is (for most of the year) 30-90 mins later at the weekend than during the weekdays. The exception is during Q2 where it is 15 mins earlier at the weekend than during the weekdays. It might be useful to investigate this pattern at greater granularity using months rather than quarters.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.lines</span> <span class="k">as</span> <span class="nn">mlines</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="n">custom_colormap</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="mi">11</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">)])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="k">for</span> <span class="n">direction</span><span class="p">,</span> <span class="n">metrics_weekday</span><span class="p">,</span> <span class="n">metrics_weekend</span><span class="p">,</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;East&quot;</span><span class="p">,</span> <span class="s2">&quot;West&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="n">east_weekday_metrics</span><span class="p">,</span> <span class="n">west_weekday_metrics</span><span class="p">],</span>
    <span class="p">[</span><span class="n">east_weekend_metrics</span><span class="p">,</span> <span class="n">west_weekend_metrics</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>  <span class="c1"># Assume there are 12 months in your data</span>
        <span class="c1"># Plot a line between the weekday and weekend points for each month</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="p">[</span><span class="n">metrics_weekday</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">metrics_weekend</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]],</span>
            <span class="p">[</span><span class="n">metrics_weekday</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">metrics_weekend</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]],</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">metrics_weekday</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">],</span>
        <span class="n">metrics_weekday</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">],</span>
        <span class="n">c</span><span class="o">=</span><span class="n">metrics_weekday</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">metrics_weekend</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">],</span>
        <span class="n">metrics_weekend</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">],</span>
        <span class="n">c</span><span class="o">=</span><span class="n">metrics_weekend</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Peak time (m after midnight)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Peak value (pedestrian flow (n/15m))&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="c1"># create a legend for quarters</span>
    <span class="n">quarter_handles</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="mi">3</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Q</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># create a legend for weekdays and weekends</span>
    <span class="n">weekday_line</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
        <span class="p">[],</span>
        <span class="p">[],</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
        <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Weekdays&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">weekend_line</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
        <span class="p">[],</span>
        <span class="p">[],</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
        <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Weekends&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
        <span class="n">handles</span><span class="o">=</span><span class="n">quarter_handles</span> <span class="o">+</span> <span class="p">[</span><span class="n">weekday_line</span><span class="p">,</span> <span class="n">weekend_line</span><span class="p">],</span>
        <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">direction</span><span class="si">}</span><span class="s2"> Peak time vs Peak value&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/a08c024e3f912dd505e3250cc304fe1e8435015ffa20d29b2eca111b9b0103e7.png" src="_images/a08c024e3f912dd505e3250cc304fe1e8435015ffa20d29b2eca111b9b0103e7.png" />
</div>
</div>
</section>
<section id="pattern-properties-of-monthly-mean-trendlines">
<span id="id9"></span><h3>2.3.3.2 Pattern properties of monthly mean trendlines<a class="headerlink" href="#pattern-properties-of-monthly-mean-trendlines" title="Permalink to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>

<span class="c1"># initialize list to store metrics DataFrames for weekends and weekdays</span>
<span class="n">east_weekend_metrics</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">east_weekday_metrics</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">west_weekend_metrics</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">west_weekday_metrics</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">month_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Jan&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Feb&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Mar&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Apr&quot;</span><span class="p">,</span>
    <span class="s2">&quot;May&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Jun&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Jul&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Aug&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Sep&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Oct&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Nov&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Dec&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># For East</span>
<span class="n">east_month_interval_mean_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">weekend_east_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">])[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># compute metrics for each month and add to DataFrame for weekends</span>
<span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">):</span>
    <span class="n">month_data</span> <span class="o">=</span> <span class="n">east_month_interval_mean_df</span><span class="p">[</span>
        <span class="n">east_month_interval_mean_df</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">month</span>
    <span class="p">]</span>
    <span class="n">auc</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span> <span class="n">dx</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>  <span class="c1"># dx time interval is 15 minutes</span>
    <span class="n">peak_time</span> <span class="o">=</span> <span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">][</span><span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()]</span>
    <span class="n">peak_value</span> <span class="o">=</span> <span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">whm_time_range</span> <span class="o">=</span> <span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">][</span>
        <span class="p">(</span><span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">peak_value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">whm</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whm_time_range</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">whm_time_range</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="p">)</span>  <span class="c1"># calculate WHM as (minutes_since_midnight is a numeric value)</span>
    <span class="n">east_weekend_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">month_names</span><span class="p">[</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
                <span class="s2">&quot;AUC&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">auc</span><span class="p">],</span>
                <span class="s2">&quot;peak_time&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">peak_time</span><span class="p">],</span>
                <span class="s2">&quot;peak_value&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">peak_value</span><span class="p">],</span>
                <span class="s2">&quot;WHM&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">whm</span><span class="p">],</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># similarly, for weekdays</span>
<span class="n">east_month_interval_mean_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">weekday_east_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">])[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># compute metrics for each month and add to DataFrame for weekdays</span>
<span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">):</span>
    <span class="n">month_data</span> <span class="o">=</span> <span class="n">east_month_interval_mean_df</span><span class="p">[</span>
        <span class="n">east_month_interval_mean_df</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">month</span>
    <span class="p">]</span>
    <span class="n">auc</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span> <span class="n">dx</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>  <span class="c1"># dx time interval is 15 minutes</span>
    <span class="n">peak_time</span> <span class="o">=</span> <span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">][</span><span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()]</span>
    <span class="n">peak_value</span> <span class="o">=</span> <span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">whm_time_range</span> <span class="o">=</span> <span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">][</span>
        <span class="p">(</span><span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">peak_value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">whm</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whm_time_range</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">whm_time_range</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="p">)</span>  <span class="c1"># calculate WHM as (minutes_since_midnight is a numeric value)</span>
    <span class="n">east_weekday_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">month_names</span><span class="p">[</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
                <span class="s2">&quot;AUC&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">auc</span><span class="p">],</span>
                <span class="s2">&quot;peak_time&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">peak_time</span><span class="p">],</span>
                <span class="s2">&quot;peak_value&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">peak_value</span><span class="p">],</span>
                <span class="s2">&quot;WHM&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">whm</span><span class="p">],</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># For West</span>
<span class="n">west_month_interval_mean_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">weekend_west_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">])[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># compute metrics for each month and add to DataFrame for weekends</span>
<span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">):</span>
    <span class="n">month_data</span> <span class="o">=</span> <span class="n">west_month_interval_mean_df</span><span class="p">[</span>
        <span class="n">west_month_interval_mean_df</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">month</span>
    <span class="p">]</span>
    <span class="n">auc</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span> <span class="n">dx</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>  <span class="c1"># dx time interval is 15 minutes</span>
    <span class="n">peak_time</span> <span class="o">=</span> <span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">][</span><span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()]</span>
    <span class="n">peak_value</span> <span class="o">=</span> <span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">whm_time_range</span> <span class="o">=</span> <span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">][</span>
        <span class="p">(</span><span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">peak_value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">whm</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whm_time_range</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">whm_time_range</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="p">)</span>  <span class="c1"># calculate WHM as (minutes_since_midnight is a numeric value)</span>
    <span class="n">west_weekend_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">month_names</span><span class="p">[</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
                <span class="s2">&quot;AUC&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">auc</span><span class="p">],</span>
                <span class="s2">&quot;peak_time&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">peak_time</span><span class="p">],</span>
                <span class="s2">&quot;peak_value&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">peak_value</span><span class="p">],</span>
                <span class="s2">&quot;WHM&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">whm</span><span class="p">],</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># similarly, for weekdays</span>
<span class="n">west_month_interval_mean_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">weekday_west_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">])[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># compute metrics for each month and add to DataFrame for weekdays</span>
<span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">):</span>
    <span class="n">month_data</span> <span class="o">=</span> <span class="n">west_month_interval_mean_df</span><span class="p">[</span>
        <span class="n">west_month_interval_mean_df</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">month</span>
    <span class="p">]</span>
    <span class="n">auc</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span> <span class="n">dx</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>  <span class="c1"># dx time interval is 15 minutes</span>
    <span class="n">peak_time</span> <span class="o">=</span> <span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">][</span><span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()]</span>
    <span class="n">peak_value</span> <span class="o">=</span> <span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">whm_time_range</span> <span class="o">=</span> <span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;minutes_since_midnight&quot;</span><span class="p">][</span>
        <span class="p">(</span><span class="n">month_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">peak_value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">whm</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">whm_time_range</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">whm_time_range</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="p">)</span>  <span class="c1"># calculate WHM as (minutes_since_midnight is a numeric value)</span>
    <span class="n">west_weekday_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">month_names</span><span class="p">[</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
                <span class="s2">&quot;AUC&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">auc</span><span class="p">],</span>
                <span class="s2">&quot;peak_time&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">peak_time</span><span class="p">],</span>
                <span class="s2">&quot;peak_value&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">peak_value</span><span class="p">],</span>
                <span class="s2">&quot;WHM&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">whm</span><span class="p">],</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># concatenate the list of dataframes to a single dataframe</span>
<span class="n">east_weekend_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">east_weekend_metrics</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">east_weekday_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">east_weekday_metrics</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">west_weekend_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">west_weekend_metrics</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">west_weekday_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">west_weekday_metrics</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Compute the deltas</span>
<span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;delta_peak_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;delta_peak_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;delta_peak_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;delta_peak_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;delta_peak_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;delta_peak_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;delta_peak_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;delta_peak_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Unsurprisingly the pattern becomes slightly more chaotic as we go more granular. However, the U shape of AUC and Peak value still largely holds and there is still a consistent seperation between weekends and weekdays for WHM. Let’s have a look at peak time and peak value on the same plot again.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="c1"># define your line plots for east with color custom_palette[0] for blue</span>
<span class="p">(</span><span class="n">east_weekday_auc</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">],</span>
    <span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;AUC&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;East Weekdays&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>
<span class="p">(</span><span class="n">east_weekend_auc</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">],</span>
    <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;AUC&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;East Weekend&quot;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>

<span class="p">(</span><span class="n">east_weekday_peak_time</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">],</span>
    <span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;East Weekdays&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>
<span class="p">(</span><span class="n">east_weekend_peak_time</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">],</span>
    <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;East Weekend&quot;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>

<span class="p">(</span><span class="n">east_weekday_peak_value</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">],</span>
    <span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;East Weekdays&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>
<span class="p">(</span><span class="n">east_weekend_peak_value</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">],</span>
    <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;East Weekend&quot;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>

<span class="p">(</span><span class="n">east_weekday_whm</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">],</span>
    <span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;WHM&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;East Weekdays&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>
<span class="p">(</span><span class="n">east_weekend_whm</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">],</span>
    <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;WHM&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;East Weekend&quot;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>

<span class="c1"># define your line plots for west with color custom_palette[1] for red</span>
<span class="p">(</span><span class="n">west_weekday_auc</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">],</span>
    <span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;AUC&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;West Weekdays&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="p">)</span>
<span class="p">(</span><span class="n">west_weekend_auc</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">],</span>
    <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;AUC&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;West Weekend&quot;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="p">)</span>

<span class="p">(</span><span class="n">west_weekday_peak_time</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">],</span>
    <span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;West Weekdays&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="p">)</span>
<span class="p">(</span><span class="n">west_weekend_peak_time</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">],</span>
    <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;West Weekend&quot;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="p">)</span>

<span class="p">(</span><span class="n">west_weekday_peak_value</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">],</span>
    <span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;West Weekdays&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="p">)</span>
<span class="p">(</span><span class="n">west_weekend_peak_value</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">],</span>
    <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;West Weekend&quot;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="p">)</span>

<span class="p">(</span><span class="n">west_weekday_whm</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">],</span>
    <span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;WHM&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;West Weekdays&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="p">)</span>
<span class="p">(</span><span class="n">west_weekend_whm</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">],</span>
    <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;WHM&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;West Weekend&quot;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">custom_palette</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="p">)</span>

<span class="c1"># the rest of the code remains unchanged</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Area Under Curve (AUC)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Peak Time&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Peak Value&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Width at Half Maximum (WHM)&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Month&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Metric Value&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># add a legend</span>
<span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="p">[</span><span class="n">east_weekday_auc</span><span class="p">,</span> <span class="n">east_weekend_auc</span><span class="p">,</span> <span class="n">west_weekday_auc</span><span class="p">,</span> <span class="n">west_weekend_auc</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;East Weekdays&quot;</span><span class="p">,</span> <span class="s2">&quot;East Weekend&quot;</span><span class="p">,</span> <span class="s2">&quot;West Weekdays&quot;</span><span class="p">,</span> <span class="s2">&quot;West Weekend&quot;</span><span class="p">],</span>
    <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/d1671645dad664db7b77d4c7228f9eec805ea98d95202dc520f9978c2bf0deb6.png" src="_images/d1671645dad664db7b77d4c7228f9eec805ea98d95202dc520f9978c2bf0deb6.png" />
</div>
</div>
<p>Again the pattern appears more chaotic but the general trend still holds. To make this easier to interpret lets plot the deltas between weekend and weekday rather than the actual values.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.lines</span> <span class="k">as</span> <span class="nn">mlines</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="n">custom_colormap</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="mi">11</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">)])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># For East</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">):</span>  <span class="c1"># for the 12 months</span>
    <span class="c1"># plot a line between the weekday and weekend points for each month</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">[</span><span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]],</span>
        <span class="p">[</span><span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]],</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="p">)</span>

<span class="c1"># plot the data</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">],</span>
    <span class="n">east_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">],</span>
    <span class="n">c</span><span class="o">=</span><span class="n">east_weekday_metrics</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">],</span>
    <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">],</span>
    <span class="n">c</span><span class="o">=</span><span class="n">east_weekend_metrics</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Peak time (m after midnight)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Peak value (pedestrian flow (n/15m))&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;East&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>

<span class="c1"># For West</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">):</span>  <span class="c1"># for the 12 months</span>
    <span class="c1"># plot a line between the weekday and weekend points for each month</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">[</span><span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]],</span>
        <span class="p">[</span><span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]],</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="p">)</span>

<span class="c1"># plot the data</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">],</span>
    <span class="n">west_weekday_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">],</span>
    <span class="n">c</span><span class="o">=</span><span class="n">west_weekday_metrics</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_time&quot;</span><span class="p">],</span>
    <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;peak_value&quot;</span><span class="p">],</span>
    <span class="n">c</span><span class="o">=</span><span class="n">west_weekend_metrics</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Peak time (m after midnight)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Peak value (pedestrian flow (n/15m))&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;West&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>

<span class="c1"># create a legend for months</span>
<span class="n">month_handles</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="mi">11</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">month_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="p">]</span>

<span class="c1"># create weekend/weekdays markers for the legend</span>
<span class="n">weekday_marker</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
    <span class="p">[],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Weekdays&quot;</span>
<span class="p">)</span>
<span class="n">weekend_marker</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
    <span class="p">[],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Weekends&quot;</span>
<span class="p">)</span>

<span class="c1"># add the legend for both the months and the weekday/weekend markers</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="n">handles</span><span class="o">=</span><span class="n">month_handles</span> <span class="o">+</span> <span class="p">[</span><span class="n">weekday_marker</span><span class="p">,</span> <span class="n">weekend_marker</span><span class="p">],</span>
    <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="n">handles</span><span class="o">=</span><span class="n">month_handles</span> <span class="o">+</span> <span class="p">[</span><span class="n">weekday_marker</span><span class="p">,</span> <span class="n">weekend_marker</span><span class="p">],</span>
    <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Peak time vs Peak value&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.93</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/ecaa3e9e8357cb02872007202e7105a4f96329a018ab9475329c3ecadb94e174.png" src="_images/ecaa3e9e8357cb02872007202e7105a4f96329a018ab9475329c3ecadb94e174.png" />
</div>
</div>
<p>If we plot these as the deltas between weekdays mean and weekends mean, we can more clearly visually group them in terms of their quandrant. The two plots below are reflections of one another along both the <span class="math notranslate nohighlight">\(y=x\)</span>, and <span class="math notranslate nohighlight">\(y=-x\)</span> axis.</p>
<p>It looks like there are three obvious cluster when observed visually. They are:</p>
<ul class="simple">
<li><p>February, October, December in <span class="math notranslate nohighlight">\((-x, y)\)</span> and <span class="math notranslate nohighlight">\((y, -x)\)</span> respectively.</p></li>
<li><p>January, March, August, November in <span class="math notranslate nohighlight">\((-x, -y)\)</span> and <span class="math notranslate nohighlight">\((x, y)\)</span> respectively.</p></li>
<li><p>April, May, June, July, August in <span class="math notranslate nohighlight">\((x, -y)\)</span> and <span class="math notranslate nohighlight">\((-x, y)\)</span> respectively.</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.lines</span> <span class="k">as</span> <span class="nn">mlines</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="n">custom_colormap</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="mi">11</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">)])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="p">)</span>  <span class="c1"># Change to 12,12 to accommodate the additional subplots</span>

<span class="c1"># Create a legend for months</span>
<span class="n">month_handles</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="mi">11</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">month_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="p">]</span>

<span class="c1"># Create a legend for weekends</span>
<span class="n">weekday_line</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
    <span class="p">[],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Weekdays&quot;</span>
<span class="p">)</span>
<span class="n">weekend_line</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
    <span class="p">[],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Weekends&quot;</span>
<span class="p">)</span>

<span class="c1"># East: Plot the deltas and the lines from the origin for weekends</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;delta_peak_time&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;delta_peak_value&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]],</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;delta_peak_time&quot;</span><span class="p">],</span>
    <span class="n">east_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;delta_peak_value&quot;</span><span class="p">],</span>
    <span class="n">c</span><span class="o">=</span><span class="n">east_weekend_metrics</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Delta peak time (m)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Delta peak value (pedestrian flow (n/15m))&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;East: Weekend delta from weekdays&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="n">handles</span><span class="o">=</span><span class="n">month_handles</span> <span class="o">+</span> <span class="p">[</span><span class="n">weekday_line</span><span class="p">,</span> <span class="n">weekend_line</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower left&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">7</span>
<span class="p">)</span>

<span class="c1"># West: Plot the deltas and the lines from the origin for weekends</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;delta_peak_time&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;delta_peak_value&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]],</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;delta_peak_time&quot;</span><span class="p">],</span>
    <span class="n">west_weekend_metrics</span><span class="p">[</span><span class="s2">&quot;delta_peak_value&quot;</span><span class="p">],</span>
    <span class="n">c</span><span class="o">=</span><span class="n">west_weekend_metrics</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Delta peak time (m)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Delta peak value (pedestrian flow (n/15m))&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;West: Weekend delta from weekdays&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Delta peak time vs Delta peak value&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/b1e2cef16feb39a694e4bfbc9a319f2815f5131179504a27db95b7415901a6a0.png" src="_images/b1e2cef16feb39a694e4bfbc9a319f2815f5131179504a27db95b7415901a6a0.png" />
</div>
</div>
<p>Lets check if any of these values hold statistical significance.</p>
<p>WIP (I can’t figure out how to do this bit just yet).</p>
</section>
</section>
<section id="signal-decomposition">
<span id="id10"></span><h2>2.3.4 Signal decomposition<a class="headerlink" href="#signal-decomposition" title="Permalink to this heading">#</a></h2>
<p>The Fourier Transform is a mathematical technique used in signal processing and image analysis, among many other fields. Named after the French mathematician and physicist Jean-Baptiste Joseph Fourier, it is a way of breaking down a complex signal into a set of simple sine waves of different frequencies. This breakdown is useful because it allows us to analyze the signal in the frequency domain, which can reveal important features that are not readily apparent in the time domain <span id="id11">[<a class="reference internal" href="#id18" title="Peter Bloomfield. Fourier analysis of time series: an introduction. John Wiley &amp; Sons, 2004.">Bloomfield, 2004</a>]</span>.</p>
<p>The Fourier Transform for a function <span class="math notranslate nohighlight">\(f(t)\)</span> is defined as:
$<span class="math notranslate nohighlight">\(
F(\omega) = \int_{-\infty}^{\infty} f(t)e^{-i\omega t} dt
\)</span>$</p>
<p>The Discrete Fourier Transform (DFT) is a version of the Fourier Transform that is suitable for sequences of numbers like a time-series. Like the Fourier Transform, it transforms a signal from the time domain into the frequency domain, but it does this for a finite set of data points rather than a continuous function. The DFT is implemented in practice using the Fast Fourier Transform (FFT) algorithm, which significantly reduces computational time <span id="id12">[<a class="reference internal" href="#id20" title="Alan V Oppenheim. Discrete-time signal processing. Pearson Education India, 1999.">Oppenheim, 1999</a>]</span>.</p>
<p>The Discrete Fourier Transform (DFT) for a sequence of <span class="math notranslate nohighlight">\(N\)</span> complex numbers <span class="math notranslate nohighlight">\(x_0, x_1, ..., x_{N-1}\)</span> is:
$<span class="math notranslate nohighlight">\(
X_k = \sum_{n=0}^{N-1} x_n e^{-\frac{i 2 \pi}{N} kn}
\)</span>$</p>
<p>The Fourier Transform transform is particularly useful in time series analysis for a couple of reasons <span id="id13">[<a class="reference internal" href="#id17" title="Ronald Newbold Bracewell and Ronald N Bracewell. The Fourier transform and its applications. Volume 31999. McGraw-Hill New York, 1986.">Bracewell and Bracewell, 1986</a>]</span>:</p>
<ol class="arabic simple">
<li><p><strong>Identification of periodicity</strong>: Fourier Transform can be used to identify cyclical patterns or seasonality by decomposing the time series into its frequency components. Peaks in the frequency domain represent the frequencies at which the data is oscillating.</p></li>
<li><p><strong>Filtering and noise reduction</strong>: By transforming the time series data into the frequency domain, it’s possible to identify and filter out high-frequency noise, making it easier to identify underlying patterns in the data.</p></li>
</ol>
<p>However, one limitation of traditional Fourier methods is that they assume the data is stationary - i.e., its properties do not change over time. This is almost certainly not the case with our data and we can expect to see trends or changes in variance over time. As a result, variations of the Fourier Transform that can handle non-stationary data, such as the Short-Time Fourier Transform or Wavelet Transform, may be more appropriate in this case <span id="id14">[<a class="reference internal" href="#id19" title="Douglas L Jones and Thomas W Parks. A resolution comparison of several time-frequency representations. In International Conference on Acoustics, Speech, and Signal Processing,, 2222–2225. IEEE, 1989.">Jones and Parks, 1989</a>]</span>.
The Short-Time Fourier Transform (STFT) of a signal <span class="math notranslate nohighlight">\(x(t)\)</span> with a chosen window function <span class="math notranslate nohighlight">\(w(t)\)</span> is given by:</p>
<div class="math notranslate nohighlight">
\[
STFT\{x(t)\}(\tau, \omega) = \int_{-\infty}^{\infty} x(t)w(t-\tau)e^{-i\omega t} dt
\]</div>
<p>The final caveat on for FFT’s is that our data is incomplete (see section 2.4) with missing periods of significanlty different length (some gaps are several weeks). All the Fourier Transforms listed above require equispaced data. For now, we want to avoid any data imputation or interpolation as this might introduce artificial patterns. The Non-equispaced Fast Fourier Transform (NFFT) offers one solution to this problem and exists as a Python library called <code class="docutils literal notranslate"><span class="pre">pyNFFT</span></code>. However it is rather difficult to install on Windows operating systems. This is something that can be attempted later on in the research.</p>
<p>The Lomb-Scargle Periodogram (LSP) is a Fourier method which is implemented in the <code class="docutils literal notranslate"><span class="pre">scipy</span></code> library and computes a Fourier-like power spectrum estimator. LSP involves fitting a model to the data at each candidate frequency and selecting the frequency that maximizes the likelihood, which makes it more flexible and suitable for data that doesn’t align neatly with whole cycles of sine waves. One of the key assumptions made by the Periodogram is that the noise is Gaussian and evenly distributed <span id="id15">[<a class="reference internal" href="#id21" title="Jacob T VanderPlas. Understanding the lomb–scargle periodogram. The Astrophysical Journal Supplement Series, 236(1):16, 2018.">VanderPlas, 2018</a>]</span>.</p>
<p>We can see from the LSP that the most powerful signals arise at 12 and 24 hour period. This makes sense as we expect the daily routine would dominate. We would expect the most powerful signals to arise in 24 hours cycles i.e. people generally carry out the same patterns of activity at the same hours of each day. The 12 hour frequency is slightly less easy to explain. It most likely arises from standards daily routines like going to work and returning home.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sorted_east_df</span> <span class="o">=</span> <span class="n">east_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;dt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">sorted_west_df</span> <span class="o">=</span> <span class="n">west_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;dt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">lombscargle</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># suppose `times` and `observations` are your data</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">sorted_east_df</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">sorted_east_df</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>
<span class="n">observations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sorted_east_df</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

<span class="c1"># normalize the input time-series data</span>
<span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">observations</span><span class="p">)</span>
<span class="n">observations</span> <span class="o">-=</span> <span class="n">mean</span>
<span class="n">variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">observations</span><span class="p">)</span>
<span class="n">observations</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">variance</span><span class="p">)</span>

<span class="c1"># define periods of interest (in seconds)</span>
<span class="n">T_hour</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span>
<span class="n">T_day</span> <span class="o">=</span> <span class="mi">24</span> <span class="o">*</span> <span class="n">T_hour</span>
<span class="n">T_week</span> <span class="o">=</span> <span class="mi">7</span> <span class="o">*</span> <span class="n">T_day</span>
<span class="n">T_month</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">*</span> <span class="n">T_day</span>  <span class="c1"># approximate</span>
<span class="n">T_quarter</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">T_month</span>
<span class="n">T_year</span> <span class="o">=</span> <span class="mi">365</span> <span class="o">*</span> <span class="n">T_day</span>

<span class="c1"># convert periods to angular frequencies and create frequency array</span>
<span class="n">freq_hour</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">T_hour</span>
<span class="n">freq_day</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">T_day</span>
<span class="n">freq_week</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">T_week</span>
<span class="n">freq_month</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">T_month</span>
<span class="n">freq_quarter</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">T_quarter</span>
<span class="n">freq_year</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">T_year</span>

<span class="n">frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">freq_year</span><span class="p">,</span> <span class="n">freq_hour</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">50000</span><span class="p">)</span>

<span class="c1"># compute the Lomb-Scargle periodogram of the normalized data</span>
<span class="n">periodogram</span> <span class="o">=</span> <span class="n">lombscargle</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">observations</span><span class="p">,</span> <span class="n">frequencies</span><span class="p">)</span>

<span class="c1"># convert angular frequencies to regular frequencies for plotting</span>
<span class="n">frequencies</span> <span class="o">=</span> <span class="n">frequencies</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

<span class="c1"># plot the periodogram with a log-scaled x-axis</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">periodogram</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="mi">1</span> <span class="o">/</span> <span class="n">T_year</span><span class="p">,</span>
        <span class="mi">1</span> <span class="o">/</span> <span class="n">T_quarter</span><span class="p">,</span>
        <span class="mi">1</span> <span class="o">/</span> <span class="n">T_month</span><span class="p">,</span>
        <span class="mi">1</span> <span class="o">/</span> <span class="n">T_week</span><span class="p">,</span>
        <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">T_day</span><span class="p">),</span>
        <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="n">T_hour</span><span class="p">),</span>
        <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">T_hour</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;1/year&quot;</span><span class="p">,</span> <span class="s2">&quot;1/quarter&quot;</span><span class="p">,</span> <span class="s2">&quot;1/month&quot;</span><span class="p">,</span> <span class="s2">&quot;1/week&quot;</span><span class="p">,</span> <span class="s2">&quot;1/day&quot;</span><span class="p">,</span> <span class="s2">&quot;1/12hour&quot;</span><span class="p">,</span> <span class="s2">&quot;1/hour&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (1/T)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Lomb Scargle Power&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Lomb-Scargle Periodogram&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/4e85583f262ad6c2f291baa545e49fe028d37c07f790090067816056b1eb6f3d.png" src="_images/4e85583f262ad6c2f291baa545e49fe028d37c07f790090067816056b1eb6f3d.png" />
</div>
</div>
<p>If we set the frequency range to 1/year and 1/week we can see more clearly the respective power of the lower frequencies. The next most powerful frequencies arise over quarterly and yearly periods. Again, we expect a reasonably strong annual signal as this means people carry out similar patterns of activity at similar points each year. Quarters are more tricky to explain, a possible reason might include the school/university holiday schedules which generally follow a quarterly cycle.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># zoom in on year to week frequency range</span>

<span class="n">frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">freq_year</span><span class="p">,</span> <span class="n">freq_week</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>

<span class="c1"># compute the Lomb-Scargle periodogram of the normalized data</span>
<span class="n">periodogram</span> <span class="o">=</span> <span class="n">lombscargle</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">observations</span><span class="p">,</span> <span class="n">frequencies</span><span class="p">)</span>

<span class="c1"># convert angular frequencies to regular frequencies for plotting</span>
<span class="n">frequencies</span> <span class="o">=</span> <span class="n">frequencies</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

<span class="c1"># plot the periodogram with a log-scaled x-axis</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">periodogram</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">1</span> <span class="o">/</span> <span class="n">T_year</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">T_quarter</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">T_month</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">T_week</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;1/year&quot;</span><span class="p">,</span> <span class="s2">&quot;1/quarter&quot;</span><span class="p">,</span> <span class="s2">&quot;1/month&quot;</span><span class="p">,</span> <span class="s2">&quot;1/week&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (1/T)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Lomb Scargle Power&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Lomb-Scargle Periodogram&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/8164ad5c663a919a27997cf32da7980c2da8033e635151cc6405fc6a6ef03aba.png" src="_images/8164ad5c663a919a27997cf32da7980c2da8033e635151cc6405fc6a6ef03aba.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">east_df</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">east_df</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Timestamp(&#39;2023-03-31 23:45:00&#39;)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="references">
<h1>References<a class="headerlink" href="#references" title="Permalink to this heading">#</a></h1>
<div class="docutils container" id="id16">
<dl class="citation">
<dt class="label" id="id18"><span class="brackets"><a class="fn-backref" href="#id11">Blo04</a></span></dt>
<dd><p>Peter Bloomfield. <em>Fourier analysis of time series: an introduction</em>. John Wiley &amp; Sons, 2004.</p>
</dd>
<dt class="label" id="id17"><span class="brackets"><a class="fn-backref" href="#id13">BB86</a></span></dt>
<dd><p>Ronald Newbold Bracewell and Ronald N Bracewell. <em>The Fourier transform and its applications</em>. Volume 31999. McGraw-Hill New York, 1986.</p>
</dd>
<dt class="label" id="id19"><span class="brackets"><a class="fn-backref" href="#id14">JP89</a></span></dt>
<dd><p>Douglas L Jones and Thomas W Parks. A resolution comparison of several time-frequency representations. In <em>International Conference on Acoustics, Speech, and Signal Processing,</em>, 2222–2225. IEEE, 1989.</p>
</dd>
<dt class="label" id="id20"><span class="brackets"><a class="fn-backref" href="#id12">Opp99</a></span></dt>
<dd><p>Alan V Oppenheim. <em>Discrete-time signal processing</em>. Pearson Education India, 1999.</p>
</dd>
<dt class="label" id="id21"><span class="brackets"><a class="fn-backref" href="#id15">Van18</a></span></dt>
<dd><p>Jacob T VanderPlas. Understanding the lomb–scargle periodogram. <em>The Astrophysical Journal Supplement Series</em>, 236(1):16, 2018.</p>
</dd>
</dl>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="2.2_Data_Description_Report.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">2.2 Data Description Report</p>
      </div>
    </a>
    <a class="right-next"
       href="2.4_Data_Quality_Report.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">2.4 Data Quality Report</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">2.3 Data Exploration Report</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#file-access-and-save-paths">2.3.1 File access and save paths</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview-of-flow-patterns">2.3.2 Overview of Flow Patterns</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#average-flow-per-hour-by-month">2.3.2.1 Average flow per hour by month</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#flow-per-hour-by-month-and-quarter-with-mean-trendline">2.3.2.2 Flow per hour by month and quarter with mean trendline</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#weekday-vs-weekend-flow-per-hour-by-quarter-with-mean-trendline">2.3.2.3 Weekday vs Weekend flow per hour by quarter with mean trendline</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#properties-of-flow-patterns">2.3.3 Properties of flow patterns</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pattern-properties-of-quarterly-mean-trendlines">2.3.3.1 Pattern properties of quarterly mean trendlines</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pattern-properties-of-monthly-mean-trendlines">2.3.3.2 Pattern properties of monthly mean trendlines</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#signal-decomposition">2.3.4 Signal decomposition</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Carrow Morris-Wiltshire
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>